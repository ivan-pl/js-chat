(()=>{"use strict";const e="https://otus-js-chat-4ed79-default-rtdb.firebaseio.com";function t(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var n="function"==typeof Symbol&&Symbol.observable||"@@observable",r=function(){return Math.random().toString(36).substring(7).split("").join(".")},o={INIT:"@@redux/INIT"+r(),REPLACE:"@@redux/REPLACE"+r(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+r()}};function s(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}const a={messageHistory:[],newMessages:[]},c=function e(r,a,c){var i;if("function"==typeof a&&"function"==typeof c||"function"==typeof c&&"function"==typeof arguments[3])throw new Error(t(0));if("function"==typeof a&&void 0===c&&(c=a,a=void 0),void 0!==c){if("function"!=typeof c)throw new Error(t(1));return c(e)(r,a)}if("function"!=typeof r)throw new Error(t(2));var u=r,d=a,f=[],l=f,m=!1;function p(){l===f&&(l=f.slice())}function g(){if(m)throw new Error(t(3));return d}function y(e){if("function"!=typeof e)throw new Error(t(4));if(m)throw new Error(t(5));var n=!0;return p(),l.push(e),function(){if(n){if(m)throw new Error(t(6));n=!1,p();var r=l.indexOf(e);l.splice(r,1),f=null}}}function h(e){if(!s(e))throw new Error(t(7));if(void 0===e.type)throw new Error(t(8));if(m)throw new Error(t(9));try{m=!0,d=u(d,e)}finally{m=!1}for(var n=f=l,r=0;r<n.length;r++)(0,n[r])();return e}function E(e){if("function"!=typeof e)throw new Error(t(10));u=e,h({type:o.REPLACE})}function b(){var e,r=y;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(t(11));function n(){e.next&&e.next(g())}return n(),{unsubscribe:r(n)}}})[n]=function(){return this},e}return h({type:o.INIT}),(i={dispatch:h,subscribe:y,getState:g,replaceReducer:E})[n]=b,i}(((e=a,t)=>{if("RECEIVED_NEW_MESSAGES"===t.type){const{messageHistory:n,newMessages:r}=t.payload;return{...e,messageHistory:n,newMessages:r}}return e})),i=c;function u(){const e=function(e){const t=[];for(const n of e)["name","message","date"].every((e=>e in n))&&t.push(n);return t}(c.getState().newMessages);var t;e.length>0&&(t=document.getElementById("message-history"),e.forEach((e=>t.append(function(e){const t=document.createElement("article");t.classList.add("message");const n=document.createElement("div");n.classList.add("message__nickname"),n.innerText=e.name;const r=document.createElement("time");r.classList.add("message__date"),r.innerText=e.date.toLocaleDateString(),r.dateTime=e.date.toString();const o=document.createElement("p");return o.classList.add("message__text"),o.innerText=e.message,[n,r,o].forEach((e=>t.append(e))),t}(e)))),t.scrollTop=t.scrollHeight)}async function d(){const t=c.getState().messageHistory.length,n=await async function(){return fetch(`${e}/messages.json`,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>e.json())).then((e=>Object.values(e).map((e=>({...e,date:new Date(e.date)})))))}();if(n.length>t){const e=n.slice(t);i.dispatch({type:"RECEIVED_NEW_MESSAGES",payload:{messageHistory:n,newMessages:e}})}}async function f(t){const n=t.target;n.querySelector("#send-message").disabled=!0,t.preventDefault();const r=document.getElementById("message-author")?.value;if(!r)return void alert("You should enter your name");const o=document.getElementById("message-entry-area")?.value;if(!o)return void alert("You should enter a message");const s={name:r,message:o};await async function(t){return fetch(`${e}/messages.json`,{method:"POST",body:JSON.stringify({...t,date:new Date}),headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>e.json()))}(s).catch((e=>{alert(`Oooops! Something happened. ${e.toString()}`)})),function(e){e.querySelector("#send-message").disabled=!1,e.querySelector("#message-author").value="",e.querySelector("#message-entry-area").value=""}(n)}!function(e,t=!1){const n=function(){const e=(e,t)=>{e.id=t,e.classList.add(t)},t=document.createElement("form");e(t,"message-box"),t.addEventListener("submit",f);const n=document.createElement("h1");n.classList.add("title"),n.innerText="Chat";const r=document.createElement("button");r.innerText="Send",e(r,"send-message");const o=document.createElement("section");e(o,"message-history");const s=document.createElement("input");s.setAttribute("type","text"),s.setAttribute("placeholder","Your name"),e(s,"message-author");const a=document.createElement("textarea");a.setAttribute("placeholder","Message text"),e(a,"message-entry-area"),[n,r,o,s,a].forEach((e=>t.append(e)));const c=document.createElement("div");return c.classList.add("app"),c.append(t),c}();e.append(n),t&&(i.subscribe(u),setInterval((()=>d()),3e3),d())}(document.body,!0)})();